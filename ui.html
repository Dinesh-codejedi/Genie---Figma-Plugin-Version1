<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: #ffffff;
      padding: 16px;
      color: #0f172a;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .label {
      font-size: 16px;
      font-weight: 500;
      color: #374151;
      margin-bottom: 6px;
      display: block;
    }

    textarea {
      width: 100%;
      padding: 10px 12px;
      font-size: 12px;
      line-height: 1.5;
      color: #0f172a;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      resize: vertical;
      font-family: inherit;
      transition: all 0.2s;
    }

    textarea:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    textarea::placeholder {
      color: #9ca3af;
    }

    button {
      width: 100%;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 500;
      color: #ffffff;
      background: #18A0FB;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }

    button:hover {
      background: #0D8CE8;
    }

    button:active {
      background: #0B7BCF;
      transform: scale(0.98);
    }

    button:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(24, 160, 251, 0.2);
    }

    #error {
      padding: 10px 12px;
      font-size: 13px;
      color: #dc2626;
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 6px;
      display: none;
      margin-top: 4px;
    }

    .helper-text {
      font-size: 10px;
      color: #6b7280;
      margin-top: 4px;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="container">
    <div>
      <label class="label" for="command">Configuration</label>
      <textarea 
        id="command" 
        rows="6" 
        
      ></textarea>
      <p class="helper-text">MODE A: pages: Page1, Page2 | layers: 5 | layerPrefix: Section<br>MODE B: Page Name -> Layer1, Layer2, Layer3</p>
    </div>
    
    <button id="generate">Generate</button>
    
    <p id="error"></p>
  </div>

  <script>
    // UI-only code - no Figma API calls
    // This script only handles input collection and message sending
    
    const errorEl = document.getElementById("error");
    const commandEl = document.getElementById("command");
    const generateBtn = document.getElementById("generate");

    /**
     * Show error message in UI
     * UI validation only - main validation happens in code.ts
     */
    function showError(msg) {
      errorEl.innerText = msg;
      errorEl.style.display = "block";
    }

    /**
     * Hide error message
     */
    function hideError() {
      errorEl.style.display = "none";
    }

    /**
     * Basic UI validation before sending message
     * Main validation and parsing happens in code.ts
     */
    function validateInput(input) {
      if (!input || !input.trim()) {
        return "Command cannot be empty";
      }

      const trimmed = input.trim();
      const hasArrow = trimmed.includes("->");
      const hasPages = trimmed.toLowerCase().includes("pages:");
      const hasLayers = trimmed.toLowerCase().includes("layers:");

      // Check for mixed modes
      if (hasArrow && (hasPages || hasLayers)) {
        return "Do not mix global and page-specific syntax";
      }

      // MODE A must have pages and layers
      if (!hasArrow && (!hasPages || !hasLayers)) {
        return "MODE A requires 'pages:' and 'layers:' fields";
      }

      return null;
    }

    /**
     * Handle generate button click
     * Collects input and sends message to main thread
     */
    generateBtn.onclick = () => {
      const input = commandEl.value.trim();
      
      // Hide previous errors
      hideError();

      // Basic UI validation
      const validationError = validateInput(input);
      if (validationError) {
        showError(validationError);
        return;
      }

      // Send message to main thread (code.ts)
      // All Figma API calls happen in code.ts, not here
      parent.postMessage(
        {
          pluginMessage: {
            type: "parse-and-generate",
            payload: input
          }
        },
        "*"
      );
    };
  </script>

</body>
</html>
